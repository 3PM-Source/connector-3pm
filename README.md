# Overview

## How to sign your requests

Your request should include the following headers

```
headers: {
	Authorization: Bearer <Signature String>
	timestamp: current timestamp when request was created on client side as a string
	tokenid: <token Id string>
	content-type: application/json // include for POST and PUT requests
}
```

The Signature String is calculated by:
<httpRequest_method>&<request_url>&<timestamp>&<secret>&<ownerId>&<tokenId>

***httpRequest_method***: the type or http request method
***request_url***: full api call url with URI Components encoded
***secret***: generated by the server during creation of token
***ownerId***: userId of the generated token
***tokenId***: the key id of the secret
***timestamp***: timestamp created before signing your request

JavaScript example (**NOTE: never hardcode keys or sensitive data on client side, fetch this from your web app's db or storage at calculation time**)
You should store your secret, ownerId and tokenId securely in your web app's db and only fetch it when calculating the signature string OR when making the actual
api request.
```
const signatureStr = method + "&" + encodedURI + "&" + timestamp + "&" + secret + "&" + ownerId + "&" + tokenId;
const signature = btoa(CryptoJS.enc.Hex.stringify(CryptoJS.HmacSHA256(signatureStr, secret))).toString("base64");
```
### MYOB API

The first step is to give a call to
```GET <baseURL>/api/companyfiles```

This will return an array of records containing company files with company specific URIs. You need to use a company specific URI to access related resources such as 
contacts, accounts, tax codes, invoice etc.

Then you can call the available apis.

### Endpoints:

1. ```GET <baseURL>/api/contacts/:companyuri/:type?/:id?```

**companyuri** is the full url you got from the array of objects returned from your call to ```/api/companyfiles```
**type** and **id** parameters are optional. If you do provide **id** however, the type parameter becomes mandatory.
acceptable values for **type** can be ***Contact***, ***Customer***, ***Supplier***, ***Employee***, ***Personal***

**id** is the unique identifier of a single contact. This is returned in contact objects.

## MYOB Integration general notes

* Invoices requires integration of Customers (Contacts), Accounts and Tax Code
* Contacts (Customers, Suppliers OR individual) requires Tax Code integration
* TaxCodes requires Accounts integration
* The Accounts and TaxCodes will just be pulled in from MYOB to the client application's form's dropdown/select box when creating Contacts OR Invoices

### Need to decide which type to integrate from the following choices:
    1. items (requires integration with an items list)
    2. ***Service*** *TO BE USED*
    3. Professional
    4. TimeBilling
    5. Miscellaneous

### End Point Specifics
	1. Contacts:
		a. Create (all requirements in payload)
			* CompanyName is required if IsIndividual is set to false otherwise not required - IsIndividual is required either way,
			* FirstName and LastName is required as contact when creating a contact
			* SellingDetails is required which MUST have the TaxCode UID, FreightTaxCode UID, SaleLayout (can set to NoDefault) and InvoiceDelivery (can set to "Print")
			* IsActive is required (Boolean: true OR false)

		b. Update (all requirements in payload)
			* UID is required
			* CompanyName is required
			* Most recent RowVersion is required
			* SellingDetails is required which MUST have the TaxCode UID, FreightTaxCode UID, SaleLayout (can set to NoDefault) and InvoiceDelivery (can set to "Print")
			
		c. Delete (No payload required)
			* Payload is not required, just need to pass the UID to endpoint.

	2. TaxCodes:
		a. Create (all requirements in payload)
			* Code is required, 3 characters ONLY,
			* Description is required
			* TaxCollectedAccount is required which MUST have the Account UID
			* TaxPaidAccount is required which MUST have the Account UID
			* IsActive is required (Boolean: true OR false)

	3. Invoices:
		a. Create
			* Customer UID, Account UID and TaxCode UID are required
			* Payload is required (see MYOB API documentation for invoices for further details)
		b. Update
			* UID of the invoice is required to update
			* Payload is required (see MYOB API documentation for invoices for further details)
		c. Delete
			* Payload is not required, just need to pass the UID to endpoint.